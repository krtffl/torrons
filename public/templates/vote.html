{{ if not .HX }}
<!DOCTYPE html>
<html lang="ca">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Vota el teu torró Vicens favorit 2025">
    <link rel="icon" href="/public/icons/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="/public/css/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/htmx.org@1.9.9" integrity="sha384-QFjmbokDn2DjBjq+fM+8LUIVrAgqcNW2s0PjAxHETgRn9l4fvX31ZxDxvwQnyMOX" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/htmx.org/dist/ext/json-enc.js"></script>
    <title>Vota - Torrorèndum 2025</title>
  </head>
  <body>
      {{ template "header" . }}
      {{ template "topbar" . }}
      {{ template "progress" . }}
      {{ template "vote" . }}
  </body>
</html>
{{ else }}
    {{ template "progress" . }}
    {{ template "vote" . }}
{{ end }}

{{ define "vote" }}
<!-- Hidden instructions for screen readers -->
<div id="voting-instructions" class="sr-only">
    Escull un dels dos torrons fent clic o prement Enter. També pots usar Tab per navegar entre opcions.
</div>
<div class="torron-comparison" role="group" aria-label="Comparació de torrons">
    {{ range .Torrons }}
        {{ template "torro" . }}
    {{ end }}
</div>
{{ end }}

{{ define "torro" }}
<div class="torron-card"
     onclick="updateProgress(event);"
     onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click();}"
     hx-post="/pairings/{{ .Pairing }}/vote?id={{ .Id }}"
     hx-trigger="click delay:0.2s"
     hx-target=".torron-comparison"
     hx-swap="outerHTML"
     tabindex="0"
     role="button"
     aria-label="Vota per {{ .Name }}"
     aria-describedby="voting-instructions">
    <div class="torron-name">
       {{ .Name }}
    </div>
    <img class="torron-image" src="/public/images/{{ .Image }}" alt="{{ .Name }} - Torrons Vicens">
</div>
{{ end }}

{{ define "progress" }}
<div id="progress">
    <div class="progress-container">
        <div id="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
    </div>
</div>

<script>
    function updateProgress(event) {
        var progressBar = document.getElementById("progress-bar");
        var currentWidth = parseFloat(progressBar.style.width) || 0;

        if (currentWidth < 100) {
            var newWidth = Math.min(currentWidth + 5, 100);
            progressBar.style.width = newWidth + "%";
            progressBar.setAttribute('aria-valuenow', newWidth);
        }
    }
</script>
{{ end }}
