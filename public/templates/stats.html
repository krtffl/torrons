{{ if not .HX }}
<!DOCTYPE html>
<html lang="ca">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Les teves estad√≠stiques de votaci√≥ - Torror√®ndum 2025">
    <link rel="icon" href="/public/icons/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="/public/css/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/htmx.org@1.9.9" integrity="sha384-QFjmbokDn2DjBjq+fM+8LUIVrAgqcNW2s0PjAxHETgRn9l4fvX31ZxDxvwQnyMOX" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/htmx.org/dist/ext/json-enc.js"></script>
    <title>Les meves estad√≠stiques - Torror√®ndum 2025</title>
  </head>
  <body>
      {{ template "header" . }}
      {{ template "topbar" . }}
      {{ template "stats" . }}
  </body>
</html>
{{ else }}
      {{ template "stats" . }}
{{ end }}

{{ define "stats" }}
<div id="stats-container">
    <div class="stats-header">
        <h1 class="stats-title">Les meves estad√≠stiques</h1>
        <p class="stats-subtitle">Segueix votant per desbloquejar els resultats de cada categoria</p>
    </div>

    <!-- Total votes summary -->
    <div class="stats-summary">
        <div class="stats-card stats-total">
            <div class="stats-icon">üó≥Ô∏è</div>
            <div class="stats-value">{{ .TotalVotes }}</div>
            <div class="stats-label">Vots totals</div>
        </div>
        <div class="stats-card stats-unlocked">
            <div class="stats-icon">üîì</div>
            <div class="stats-value">{{ .UnlockedCategories }}</div>
            <div class="stats-label">Categories desbloquejades</div>
        </div>
        <div class="stats-card stats-rank">
            <div class="stats-icon">‚≠ê</div>
            <div class="stats-value">{{ .UserRank }}</div>
            <div class="stats-label">Nivell de votant</div>
        </div>
    </div>

    <!-- Category progress -->
    <div class="category-progress-list">
        <h2 class="section-title">Progr√©s per categoria</h2>

        {{ range .CategoryProgress }}
        <div class="category-progress-item {{ if .Unlocked }}unlocked{{ end }}">
            <div class="category-progress-header">
                <div class="category-info">
                    <span class="category-icon">{{ .Icon }}</span>
                    <span class="category-name">{{ .Name }}</span>
                </div>
                <div class="category-votes">
                    <span class="votes-current">{{ .VoteCount }}</span>
                    <span class="votes-separator">/</span>
                    <span class="votes-required">{{ .MinVotes }}</span>
                    <span class="votes-label">vots</span>
                </div>
            </div>

            <div class="category-progress-bar">
                <div class="progress-fill" style="width: {{ .ProgressPercentage }}%"></div>
            </div>

            <div class="category-progress-footer">
                {{ if .Unlocked }}
                <span class="progress-status unlocked">‚úì Resultats desbloquejats</span>
                <a href="/leaderboard?view=personal&category={{ .Id }}" class="btn-small" hx-get="/leaderboard?view=personal&category={{ .Id }}" hx-boost="true" hx-target="body" hx-push-url="/leaderboard?view=personal&category={{ .Id }}">
                    Veure resultats
                </a>
                {{ else }}
                <span class="progress-status locked">üîí Necessites {{ .VotesRemaining }} vots m√©s</span>
                <a href="/classes/{{ .Id }}/vote" class="btn-small" hx-get="/classes/{{ .Id }}/vote" hx-boost="true" hx-target="body" hx-push-url="/classes/{{ .Id }}/vote">
                    Continua votant
                </a>
                {{ end }}
            </div>
        </div>
        {{ end }}
    </div>

    <!-- Achievements -->
    {{ if .Achievements }}
    <div class="achievements-section">
        <h2 class="section-title">Assoliments</h2>
        <div class="achievements-grid">
            {{ range .Achievements }}
            <div class="achievement-badge {{ if .Unlocked }}unlocked{{ else }}locked{{ end }}">
                <div class="achievement-icon">{{ .Icon }}</div>
                <div class="achievement-name">{{ .Name }}</div>
                <div class="achievement-description">{{ .Description }}</div>
            </div>
            {{ end }}
        </div>
    </div>
    {{ end }}

    <!-- Actions -->
    <div class="stats-footer">
        <button class="btn" hx-get="/classes" hx-trigger="click" hx-target="#stats-container" hx-swap="outerHTML" hx-push-url="/classes">
            Torna a votar
        </button>
        <a href="/leaderboard" class="btn" hx-get="/leaderboard" hx-boost="true" hx-target="body" hx-push-url="/leaderboard">
            Veure classificaci√≥
        </a>
    </div>
</div>
{{ end }}
